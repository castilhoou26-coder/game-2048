<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>2048 Final Animado e Fluido</title>
<style>
    body {
        font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;
        background: #faf8ef;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        position: relative;
    }
    #score-board {
        display: flex;
        justify-content: space-between;
        width: 340px;
        margin-bottom: 20px;
    }
    #score, #highscore {
        background: #bbada0;
        padding: 10px 20px;
        border-radius: 5px;
        color: #f9f6f2;
        font-weight: bold;
    }
    #game-container {
        position: relative;
        width: 340px;
        height: 340px;
        background: #bbada0;
        border-radius: 5px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, 1fr);
        gap: 10px;
        padding: 10px;
    }
    .cell {
        background: #cdc1b4;
        border-radius: 5px;
        width: 100%;
        height: 100%;
    }
    .tile {
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: #776e65;
        border-radius: 5px;
        transition: all 0.2s ease;
    }
    .tile-2 { background: #eee4da; font-size: 24px; }
    .tile-4 { background: #ede0c8; font-size: 24px; }
    .tile-8 { background: #f2b179; font-size: 24px; color: #f9f6f2; }
    .tile-16 { background: #f59563; font-size: 24px; color: #f9f6f2; }
    .tile-32 { background: #f67c5f; font-size: 24px; color: #f9f6f2; }
    .tile-64 { background: #f65e3b; font-size: 24px; color: #f9f6f2; }
    .tile-128 { background: #edcf72; font-size: 20px; color: #f9f6f2; }
    .tile-256 { background: #edcc61; font-size: 20px; color: #f9f6f2; }
    .tile-512 { background: #edc850; font-size: 20px; color: #f9f6f2; }
    .tile-1024 { background: #edc53f; font-size: 18px; color: #f9f6f2; }
    .tile-2048 { background: #edc22e; font-size: 18px; color: #f9f6f2; }
    .win { animation: winAnim 0.5s ease; }
    @keyframes winAnim {
        0% { transform: scale(1); background-color: #edc22e; }
        50% { transform: scale(1.3); background-color: #ffeb3b; }
        100% { transform: scale(1); background-color: #edc22e; }
    }
    #overlay {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        font-size: 36px;
        font-weight: bold;
        border-radius: 5px;
        display: none;
        animation: fadeIn 0.5s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    #arrow-controls {
        display: grid;
        grid-template-columns: 80px 80px 80px;
        grid-template-rows: 80px 80px 80px;
        grid-gap: 5px;
        justify-items: center;
        align-items: center;
        margin-top: 20px;
    }
    #arrow-controls button {
        width: 60px;
        height: 60px;
        font-size: 20px;
        font-weight: bold;
        border-radius: 5px;
        border: none;
        background: #8f7a66;
        color: #f9f6f2;
        cursor: pointer;
        transition: 0.1s;
    }
    #arrow-controls button:active { transform: scale(0.9); }

    /* Rodapé fixo */
    #footer {
        position: fixed;
        bottom: 10px;
        text-align: center;
        font-size: 14px;
        color: #776e65;
        width: 100%;
        user-select: none;
    }
</style>
</head>
<body>

<div id="score-board">
    <div id="score">Score: 0</div>
    <div id="highscore">Highscore: 0</div>
</div>

<div id="game-container">
    <div id="overlay">Game Over!</div>
</div>

<div id="arrow-controls">
    <div></div><button id="up">↑</button><div></div>
    <button id="left">←</button><div></div><button id="right">→</button>
    <div></div><button id="down">↓</button><div></div>
</div>

<div id="footer">Desenvolvido por Daniel Castilho</div>

<script>
const container = document.getElementById('game-container');
let tabuleiro = [
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0]
];
let pontuacao = 0;
let highscore = localStorage.getItem('highscore') || 0;

function render() {
    container.querySelectorAll('.tile').forEach(t => t.remove());
    for(let i=0;i<4;i++){
        for(let j=0;j<4;j++){
            if(tabuleiro[i][j]!==0){
                const tile = document.createElement('div');
                tile.className = 'tile tile-' + tabuleiro[i][j];
                tile.textContent = tabuleiro[i][j];
                tile.style.width = tile.style.height = (container.clientWidth-50)/4 + 'px';
                tile.style.top = 10 + i*((container.clientWidth-50)/4 +10) + 'px';
                tile.style.left = 10 + j*((container.clientWidth-50)/4 +10) + 'px';
                container.appendChild(tile);
            }
        }
    }
    document.getElementById('score').textContent = 'Score: ' + pontuacao;
    document.getElementById('highscore').textContent = 'Highscore: ' + highscore;
}

function addNumero() {
    let vazios = [];
    for(let i=0;i<4;i++){
        for(let j=0;j<4;j++){
            if(tabuleiro[i][j]===0) vazios.push([i,j]);
        }
    }
    if(vazios.length>0){
        let [i,j] = vazios[Math.floor(Math.random()*vazios.length)];
        tabuleiro[i][j] = Math.random()<0.9?2:4;
    }
}

function moverEsquerda() {
    for(let i=0;i<4;i++){
        let linha = tabuleiro[i].filter(n=>n!==0);
        for(let j=0;j<linha.length-1;j++){
            if(linha[j]===linha[j+1]){
                linha[j]*=2;
                pontuacao += linha[j];
                if(pontuacao>highscore){
                    highscore = pontuacao;
                    localStorage.setItem('highscore',highscore);
                }
                linha[j+1]=0;
            }
        }
        linha = linha.filter(n=>n!==0);
        while(linha.length<4) linha.push(0);
        tabuleiro[i]=linha;
    }
}

function moverDireita() {
    for(let i=0;i<4;i++){
        tabuleiro[i].reverse();
        moverEsquerda();
        tabuleiro[i].reverse();
    }
}

function transpor() {
    tabuleiro = tabuleiro[0].map((_,i)=>tabuleiro.map(linha=>linha[i]));
}

function moverCima(){ transpor(); moverEsquerda(); transpor(); }
function moverBaixo(){ transpor(); moverDireita(); transpor(); }

function checkGameOver() {
    let vazio = false;
    for(let i=0;i<4;i++){
        for(let j=0;j<4;j++){
            if(tabuleiro[i][j]===0) vazio=true;
            if(tabuleiro[i][j]===2048){
                document.querySelectorAll('.tile-2048').forEach(t=>t.classList.add('win'));
            }
        }
    }
    if(!vazio){
        const overlay = document.getElementById('overlay');
        overlay.style.display='flex';
    }
}

let touchStartX=0, touchStartY=0;
document.addEventListener('touchstart', e=>{ touchStartX=e.changedTouches[0].screenX; touchStartY=e.changedTouches[0].screenY; }, false);
document.addEventListener('touchend', e=>{
    let dx=e.changedTouches[0].screenX-touchStartX;
    let dy=e.changedTouches[0].screenY-touchStartY;
    let moved=false;
    if(Math.abs(dx)>Math.abs(dy)){
        if(dx>30){ moverDireita(); moved=true; }
        else if(dx<-30){ moverEsquerda(); moved=true; }
    }else{
        if(dy>30){ moverBaixo(); moved=true; }
        else if(dy<-30){ moverCima(); moved=true; }
    }
    if(moved){ addNumero(); render(); checkGameOver(); }
}, false);

document.getElementById('up').addEventListener('click', ()=>{ moverCima(); addNumero(); render(); checkGameOver(); });
document.getElementById('down').addEventListener('click', ()=>{ moverBaixo(); addNumero(); render(); checkGameOver(); });
document.getElementById('left').addEventListener('click', ()=>{ moverEsquerda(); addNumero(); render(); checkGameOver(); });
document.getElementById('right').addEventListener('click', ()=>{ moverDireita(); addNumero(); render(); checkGameOver(); });

document.addEventListener('keydown', e=>{
    let moved=false;
    switch(e.key){
        case 'ArrowLeft': moverEsquerda(); moved=true; break;
        case 'ArrowRight': moverDireita(); moved=true; break;
        case 'ArrowUp': moverCima(); moved=true; break;
        case 'ArrowDown': moverBaixo(); moved=true; break;
    }
    if(moved){ addNumero(); render(); checkGameOver(); }
});

addNumero();
addNumero();
render();
</script>
</body>
</html>
